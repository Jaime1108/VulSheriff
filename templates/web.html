<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VulSheriff - Vulnerability Bounty Hunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
    
    </style>
</head>
<body class="western-bg min-h-full">
    <div class="min-h-full">
        <!-- Header -->
        <header class="leather-texture border-b-4 border-yellow-600 shadow-lg">
            <div class="max-w-6xl mx-auto px-4 py-6">
                <div class="flex items-center justify-center space-x-4">
                    <div class="sheriff-badge w-16 h-16 flex items-center justify-center">
                        <span class="text-2xl">‚≠ê</span>
                    </div>
                    <div class="text-center">
                        <h1 class="cowboy-font text-4xl md:text-6xl text-yellow-300 drop-shadow-lg">
                            VulSheriff
                        </h1>
                        <p class="text-yellow-200 text-lg md:text-xl font-bold">
                            ü§† Vulnerability Bounty Hunter ü§†
                        </p>
                    </div>
                    <div class="sheriff-badge w-16 h-16 flex items-center justify-center">
                        <span class="text-2xl">‚≠ê</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-4xl mx-auto px-4 py-8">
            <!-- Welcome Message -->
            <div class="rope-border bg-amber-50 p-6 mb-8 shadow-xl">
                <div class="text-center">
                    <h2 class="cowboy-font text-3xl text-amber-900 mb-4">
                        üéØ Howdy, Partner! üéØ
                    </h2>
                    <p class="text-amber-800 text-lg">
                        Welcome to VulSheriff's AI-powered vulnerability hunting station! 
                        Drop your code or describe your security concerns, and I'll help you track down those pesky bugs faster than a tumbleweed in a tornado!
                    </p>
                </div>
            </div>
            
            <!-- Chat Interface -->
            <div class="rope-border bg-white shadow-2xl">
                <!-- Chat Header -->
                <div class="leather-texture px-6 py-4 border-b-2 border-amber-600">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-amber-500 rounded-full flex items-center justify-center">
                            <span class="text-xl">ü§ñ</span>
                        </div>
                        <div>
                            <h3 class="cowboy-font text-xl text-yellow-200">Sheriff AI Assistant</h3>
                            <p class="text-yellow-300 text-sm">Ready to hunt vulnerabilities</p>
                        </div>
                        <div class="ml-auto">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                üü¢ Online
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Chat Messages Area -->
                <div id="chatMessages" class="h-96 overflow-y-auto p-6 space-y-4 bg-gradient-to-b from-amber-50 to-white">
                    <div class="chat-bubble flex items-start space-x-3">
                        <div class="w-8 h-8 bg-amber-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-sm">ü§ñ</span>
                        </div>
                        <div class="bg-amber-100 rounded-lg p-4 max-w-md border-2 border-amber-200">
                            <p class="text-amber-900">
                                <strong>Howdy there, partner! ü§†</strong><br>
                                I'm your AI vulnerability sheriff. Upload a file or describe your security concerns, and I'll help you hunt down those bugs! What can I investigate for you today?
                            </p>
                        </div>
                    </div>
                </div>
                {% block content %}
                <!-- Input Form -->
                <form id="chatForm" action="{{ url_for('analyze') }}" method="post" enctype="multipart/form-data" class="border-t-2 border-amber-200 p-6 bg-amber-25">
                        <!-- Text Input -->
                        <div>
                            <label for="messageInput" class="block text-sm font-bold text-amber-900 mb-2">
                                üó®Ô∏è Describe your security concern or ask a question:
                            </label>
                            <textarea 
                                id="messageInput" name ="notes"
                                rows="3" 
                                class="w-full px-4 py-3 border-2 border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 resize-none"
                                placeholder="Tell me about the vulnerability you want to investigate, or ask any security-related question..."
                            ></textarea>
                        </div>

                        <!-- File Upload -->
                        <div>
                            <label for="fileInput" class="block text-sm font-bold text-amber-900 mb-2">
                                üìÅ Upload a file for analysis (optional):
                            </label>
                            <div class="relative">
                                <input 
                                    type="file" 
                                    id="fileInput" 
                                    class="hidden"
                                    accept=".txt,.js,.py,.php,.java,.cpp,.c,.html,.css,.json,.xml,.log,.zip"
                                    name="zip_file"
                                >
                                <label 
                                    for="fileInput" 
                                    class="flex items-center justify-center w-full px-4 py-6 border-2 border-dashed border-amber-400 rounded-lg cursor-pointer hover:bg-amber-50 transition-colors"
                                >
                                
                                    <div class="text-center">
                                        <span class="text-3xl mb-2 block">üìé</span>
                                        <span class="text-amber-700 font-medium">Click to upload file</span>
                                        <p class="text-amber-600 text-sm mt-1">Supports code files, logs, and documents</p>
                                    </div>
                                </label>
                            </div>
                            <div id="fileInfo" class="mt-2 text-sm text-amber-700 hidden">
                                <span class="inline-flex items-center px-2 py-1 rounded bg-amber-200">
                                    <span id="fileName"></span>
                                    <button type="button" id="removeFile" class="ml-2 text-amber-800 hover:text-red-600">‚úï</button>
                                </span>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="flex justify-end">
                            <button 
                                type="submit" 
                                id="submitBtn"
                                class="cowboy-font px-8 py-3 bg-gradient-to-r from-amber-600 to-amber-700 text-white rounded-lg hover:from-amber-700 hover:to-amber-800 focus:ring-4 focus:ring-amber-300 transition-all duration-200 shadow-lg text-lg font-bold"
                            >
                                üîç Hunt Vulnerabilities!
                            </button>
                            {% endblock %}
                        </div>
                    </div>
                </form>
            </div>

            <!-- Footer Info -->
            <div class="mt-8 text-center">
                <p class="text-amber-200 text-sm">
                    üõ°Ô∏è Powered by AI ‚Ä¢ Securing the digital frontier one vulnerability at a time ‚Ä¢ üõ°Ô∏è
                </p>
            </div>
        </main>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const chatForm = document.getElementById('chatForm');
        const messageInput = document.getElementById('messageInput');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const removeFile = document.getElementById('removeFile');
        const submitBtn = document.getElementById('submitBtn');

        let selectedFile = null;

        // File upload handling
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                selectedFile = file;
                fileName.textContent = `üìÑ ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                fileInfo.classList.remove('hidden');
            }
        });

        // Remove file
        removeFile.addEventListener('click', function() {
            selectedFile = null;
            fileInput.value = '';
            fileInfo.classList.add('hidden');
        });
        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
        
            const message = messageInput.value.trim();
            const file = fileInput.files[0];
        
            if (!message && !file) return;
        
            // Show user message
            addMessage(message || "I've uploaded a file for analysis.", true, !!file);
        
            // Build form data
            const formData = new FormData();
            formData.append("notes", message);       // matches request.form.get("notes")
            if (file) formData.append("zip_file", file); // matches request.files.get("zip_file")
        
            // Send to Flask endpoint
            addMessage("‚è≥ Sending to the sheriff's office for analysis...", false);
        
            const response = await fetch("{{ url_for('analyze') }}", {
                method: "POST",
                body: formData
            });
        
            const data = await response.text();  // Flask can return plain text
            addMessage(data, false);  // Show Flask‚Äôs actual response
        });
        
        // Add message to chat
        /*
        function addMessage(content, isUser = false, hasFile = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-bubble flex items-start space-x-3 ${isUser ? 'flex-row-reverse space-x-reverse' : ''}`;
            
            const avatar = isUser ? 'ü§†' : 'ü§ñ';
            const bgColor = isUser ? 'bg-blue-100 border-blue-200' : 'bg-amber-100 border-amber-200';
            const textColor = isUser ? 'text-blue-900' : 'text-amber-900';
            
            messageDiv.innerHTML = `
                <div class="w-8 h-8 ${isUser ? 'bg-blue-500' : 'bg-amber-500'} rounded-full flex items-center justify-center flex-shrink-0">
                    <span class="text-sm">${avatar}</span>
                </div>
                <div class="${bgColor} rounded-lg p-4 max-w-md border-2">
                    ${hasFile ? `<div class="mb-2 text-xs ${textColor} opacity-75">üìé File attached: ${selectedFile.name}</div>` : ''}
                    <p class="${textColor}">${content}</p>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Simulate AI response
        function simulateAIResponse(userMessage, hasFile) {
            const responses = [
                "üîç Well howdy! I've analyzed your request and I'm ready to help hunt down those vulnerabilities. Let me investigate this for you...",
                "üéØ Partner, I see what you're getting at! Based on what you've shared, here are some potential security concerns to watch out for...",
                "üõ°Ô∏è Great question, sheriff! Security is mighty important, and I've got some insights that might help you secure that digital frontier...",
                "ü§† Now that's what I call good security thinking! Let me break down what I found and give you some recommendations...",
                "‚ö° Hot diggity! I've spotted some areas that need attention. Here's what this old AI sheriff recommends..."
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            setTimeout(() => {
                addMessage(randomResponse);
                
                // Add a follow-up technical response
                setTimeout(() => {
                    const technicalResponse = hasFile 
                        ? "üìã I've processed your uploaded file and found several areas to investigate. The code structure looks solid, but I'd recommend checking for input validation, authentication mechanisms, and potential injection vulnerabilities. Would you like me to dive deeper into any specific area?"
                        : "üí° Based on your description, I'd suggest focusing on common vulnerability patterns like SQL injection, XSS, CSRF, and authentication bypasses. Each of these can be like hidden rattlesnakes in your code! Want me to explain any of these in more detail?";
                    
                    addMessage(technicalResponse);
                }, 1500);
            }, 1000);
        }

        // Form submission
        chatForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const message = messageInput.value.trim();
            if (!message && !selectedFile) {
                return;
            }
            
            // Add user message
            const userContent = message || "I've uploaded a file for analysis.";
            addMessage(userContent, true, !!selectedFile);
            
            // Simulate AI response
            simulateAIResponse(message, !!selectedFile);
            
            // Reset form
            messageInput.value = '';
            if (selectedFile) {
                selectedFile = null;
                fileInput.value = '';
                fileInfo.classList.add('hidden');
            }
        });
        */
        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99459603d3982d41',t:'MTc2MTQzNTkwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
